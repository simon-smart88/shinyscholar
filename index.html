<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A template for creating modular reproducible shiny applications • shinyscholar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="A template for creating modular reproducible shiny applications">
<meta property="og:description" content="The shiny application shinyscholar is a modular platform for creating reproducible applications to academic standards. shinyscholar is forked from wallace and provides a template for producing applications that are interactive, reproducible, adaptable and built to high standards.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">shinyscholar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="shinyscholar-v020">shinyscholar (v0.2.0)<a class="anchor" aria-label="anchor" href="#shinyscholar-v020"></a>
</h1></div>
<p><img src="https://raw.githubusercontent.com/simon-smart88/shinyscholar/master/inst/shiny/www/logo.png" width="259" height="300" align="right" style="border:10px solid white;"></p>
<p>Shinyscholar is a basic application written in R that can be used as a template to create complex applications that are modular, meet academic standards of attribution and are reproducible outside of the application. By using <em>shinyscholar</em>, to create a template application, developers will be encouraged to produce applications that are maintainable and run reliably without having to learn software development best-practices from scratch. <em>shinyscholar</em> was <a href="https://github.com/wallaceEcoMod/wallace/tree/51a3ebe10ffd797fc36ad2d2cf8245b014d11b41" class="external-link">forked</a> from <a href="http://wallaceecomod.github.io/wallace/" class="external-link">wallace</a> v2.0.5 (<a href="https://cran.r-project.org/package=wallace" class="external-link">CRAN</a>, <a href="https://wallaceecomod.github.io/wallace/index.html" class="external-link">website</a>) a modular platform for reproducible modelling of species distributions. Specifically, it harnesses the higher-level structure and core attributes of Wallace but removes its discipline-specific features, yielding a generic template for developers to make their own applications. We are very grateful to the contributors to <a href="http://wallaceecomod.github.io/wallace/" class="external-link">wallace</a> and the features retained from it and the new features added in <em>shinyscholar</em> are described in <code>NEWS</code>.</p>
<p><em>Shinyscholar</em> contains four components (Select, Plot, Reproduce, Template) each of which contain one or two modules (<code>select_query</code>, <code>select_async</code>, <code>select_user</code>, <code>plot_hist</code>, <code>plot_scatter</code>, <code>rep_markdown</code>, <code>rep_renv</code>, <code>rep_refPackages</code> and <code>template_create</code>) and their code is found in the <code>inst/shiny/modules</code> directory. Each of the modules in the Select and Plot components calls a function with the same name that is found in the <code>R</code> directory. The <code>select_query</code> module and underlying function is the most complex, containing various components for handling errors, both in the module and in the function. The other modules are very simple but included to demonstrate how multiple components and modules can be used. The Reproduce component is used to generate an rmarkdown document that reproduces the analysis conducted in the application. The Template component can be used to produce and download a template version of an app with the same features.</p>
<p>Install <em>shinyscholar</em> via Github and run the application with the following R code.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"simon-smart88/shinyscholar"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://simon-smart88.github.io/shinyscholar/" class="external-link">shinyscholar</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/run_shinyscholar.html">run_shinyscholar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>An individual module can be run for development purposes using <code><a href="reference/run_module.html">run_module()</a></code> e.g. <code>run_module("select_query")</code> but this requires the most recent version of the package to be installed.</p>
<div class="section level2">
<h2 id="justification">Justification<a class="anchor" aria-label="anchor" href="#justification"></a>
</h2>
<p>Shiny apps are a great way to lower the barrier for entry for users to complete complex analyses, by enabling online access to the rich ecosystem of R packages through a graphical user interface. However, often apps produced by academics do not follow best practices in software development or open science. If apps become popular, more features are requested and developers move onto new roles, it may become difficult to maintain their codebase. If users cannot reproduce their analyses outside of the application, it prevents them from modifying analyses to suit their particular use-case, makes it harder to understand the analysis and limits their ability to use the results in publications. Additionally, it may not be possible to determine which R packages are being used in the application, making it more onerous to cite the packages in publications. Other packages exist for creating templates of shiny apps, e.g. <a href="https://github.com/ThinkR-open/golem" class="external-link">golem</a> and <a href="https://appsilon.github.io/rhino/" class="external-link">rhino</a> but these are more generic and do not contain features specifically for use by academics.</p>
<p><a href="http://wallaceecomod.github.io/wallace/" class="external-link">wallace</a> addressed these shortcomings and the attributes of <em>shinyscholar</em> are built upon those of <a href="http://wallaceecomod.github.io/wallace/" class="external-link">wallace</a>. Apps built using <em>shinyscholar</em> should maintain these characteristics:</p>
<ul>
<li>
<strong>accessible</strong>: lowers barriers to implementing complex modular <a href="https://shiny.posit.co/" class="external-link">shiny</a> apps for scientific analysis by providing an intuitive graphical user interface</li>
<li>
<strong>open</strong>: the code is free to use and modify (GPL 3.0) and can be viewed from inside the application</li>
<li>
<strong>expandable</strong>: users can author and contribute modules that enable new methodological options</li>
<li>
<strong>flexible</strong>: options for user uploads and downloads of results</li>
<li>
<strong>interactive</strong>: includes an embedded zoomable <a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a> map, sortable <code>{DF}</code> data tables, and visualizations of results</li>
<li>
<strong>instructive</strong>: features guidance text that educates users about theoretical and analytical aspects of each step in the workflow</li>
<li>
<strong>reproducible</strong>: users can download an <a href="https://github.com/rstudio/rmarkdown" class="external-link">rmarkdown</a> .Rmd file that when run reproduces the analysis, and also save sessions and load them later</li>
<li>
<strong>reliable</strong>: modules and their underlying functions are tested using <a href="https://testthat.r-lib.org" class="external-link">testthat</a> and <a href="https://rstudio.github.io/shinytest2/" class="external-link">shinytest2</a>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="use-cases">Use cases<a class="anchor" aria-label="anchor" href="#use-cases"></a>
</h2>
<p>Shinyscholar is aimed towards creating applications for complex analyses that have several steps and where there may be multiple options for each step e.g. where the data is sourced from, which model is used or how the results are plotted. It is probably not suitable for use if you have never developed a shiny app before, but if you have developed a simple app which is growing in complexity, it should be fairly straightforward to migrate your code across.</p>
</div>
<div class="section level2">
<h2 id="using-shinyscholar-as-a-template">Using shinyscholar as a template<a class="anchor" aria-label="anchor" href="#using-shinyscholar-as-a-template"></a>
</h2>
<div class="section level3">
<h3 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h3>
<p>Shinyscholar is licensed under the GPLv3 license and consequently any apps made using shinyscholar must be licensed under the same license.</p>
</div>
<div class="section level3">
<h3 id="initialisation">Initialisation<a class="anchor" aria-label="anchor" href="#initialisation"></a>
</h3>
<p>The <code><a href="reference/create_template.html">create_template()</a></code> function can be used to create the template for a new app. For example, the following call will produce a folder called <code>demo</code> in your Documents folder and create an app containing two components (load and plot) each containing two modules. You can choose whether certain features are included in the overall app by setting the <code>include_*</code> parameters and also whether each module contains mapping, result, rmarkdown and save functionality by setting the parameters inside the <code>modules</code> dataframe. <code>common_objects</code> contains the name of objects shared between modules and will be available inside all of the modules as e.g. <code>common$raster</code>. See <a href="#common.R">this section</a> for more details on the <code>common</code> data structure.</p>
<p>You can also generate a template app using the Template component of the app either run locally with <code><a href="reference/run_shinyscholar.html">run_shinyscholar()</a></code> or at <a href="https://simonsmart.shinyapps.io/shinyscholar/" class="external-link uri">https://simonsmart.shinyapps.io/shinyscholar/</a></p>
<pre><code><span><span class="va">modules</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span><span class="st">"component"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"load"</span>, <span class="st">"load"</span>, <span class="st">"plot"</span>, <span class="st">"plot"</span><span class="op">)</span>,</span>
<span><span class="st">"long_component"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Load data"</span>, <span class="st">"Load data"</span>, <span class="st">"Plot data"</span>, <span class="st">"Plot data"</span><span class="op">)</span>,</span>
<span><span class="st">"module"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"user"</span>, <span class="st">"database"</span>, <span class="st">"histogram"</span>, <span class="st">"scatter"</span><span class="op">)</span>,</span>
<span><span class="st">"long_module"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Upload your own data"</span>, <span class="st">"Query a database to obtain data"</span>, <span class="st">"Plot the data as a histogram"</span>, <span class="st">"Plot the data as a scatterplot"</span><span class="op">)</span>,</span>
<span><span class="st">"map"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span><span class="st">"result"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span><span class="st">"rmd"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span><span class="st">"save"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">common_objects</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"raster"</span>, <span class="st">"histogram"</span>, <span class="st">"scatter"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">shinyscholar</span><span class="fu">::</span><span class="fu"><a href="reference/create_template.html">create_template</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"~"</span>, <span class="st">"Documents"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"demo"</span>, author <span class="op">=</span> <span class="st">"Simon E. H. Smart"</span>,</span>
<span>include_map <span class="op">=</span> <span class="cn">TRUE</span>, include_table <span class="op">=</span> <span class="cn">TRUE</span>, include_code <span class="op">=</span> <span class="cn">TRUE</span>, common_objects <span class="op">=</span> <span class="va">common_objects</span>, modules <span class="op">=</span> <span class="va">modules</span>, install <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p><code><a href="reference/create_template.html">create_template()</a></code> creates the file structure of a package and if <code>install</code> is set to <code>TRUE</code> it will be installed automatically. If you prefer to install manually, run <code>devtools::install_local(path = "~/Documents/demo", force=TRUE)</code> (assuming as in the example above the app was initiated in <code>~/Documents/demo</code>). You need to repeat this process after making changes to the app, or if using Rstudio, use Ctrl+Shift+B or Command+Shift+B. Now you can run the app using <code>shiny::runApp(system.file('shiny', package='demo'))</code> or <code>demo::run_demo()</code>.</p>
</div>
<div class="section level3">
<h3 id="development">Development<a class="anchor" aria-label="anchor" href="#development"></a>
</h3>
<div class="section level4">
<h4 id="modules">Modules<a class="anchor" aria-label="anchor" href="#modules"></a>
</h4>
<p>After installing the initial version, the modules only contain skeleton code. There are four files for each module located in <code>/inst/shiny/modules</code> and each module calls a function found in <code>/R</code>. It may be helpful to familiarise yourself with the code for the existing application either by viewing the files in <code>/inst/shiny/modules</code> or by using the Code tab in the app.</p>
<div class="section level5">
<h5 id="r">.R<a class="anchor" aria-label="anchor" href="#r"></a>
</h5>
<p>This is the main module file and contains the UI and server components as well as any other functionality specified at initialisation. <code>&lt;identifier&gt;</code> is used as a placeholder for the identifier of the module e.g. load_user.</p>
<p>The <code>&lt;identifier&gt;_module_ui</code> function can be developed just like a normal UI function inside a shiny app, but only contains *Input elements and the input ids need wrapping inside <code>ns()</code> to create ids that are unique to the module. The template contains an <code>actionButton</code> which when clicked runs the code inside the <code>*_module_server</code> function. If the computations performed by the module are simple, then you could choose to remove the <code><a href="https://rdrr.io/pkg/shiny/man/actionButton.html" class="external-link">actionButton()</a></code> in the UI and the <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent()</a></code> so that the server runs reactively whenever the inputs are changed.</p>
<p>The <code>&lt;identifier&gt;_module_server</code> function contains an <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent()</a></code> which is run when the <code><a href="https://rdrr.io/pkg/shiny/man/actionButton.html" class="external-link">actionButton()</a></code> in the UI is clicked. Inside the <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent()</a></code> there is a consistent structure to the code:</p>
<ul>
<li>In the <em>warning</em> block, examine inputs to check that they are as expected and issue warnings if not using <code>common$logger %&gt;% writeLog()</code> See the documentation of <code><a href="reference/writeLog.html">shinyscholar::writeLog()</a></code> for more details.</li>
<li>In the <em>function call</em> block, pass the inputs to the module function.</li>
<li>In the <em>load into common</em> block, store the result(s) of the function call in the relevant <code>common</code> object.</li>
<li>In the <em>metadata</em> block, store any relevant input metadata which is required to reproduce the function call, or is used in the mapping function, in the <code>common$meta$&lt;identifier&gt;</code> object. This can be semi-automated using the <code><a href="reference/metadata.html">metadata()</a></code> function once you have finished developing the module.</li>
<li>In the <em>trigger</em> block, <code><a href="https://rdrr.io/pkg/gargoyle/man/Event.html" class="external-link">gargoyle::trigger()</a></code> is called which can be used to trigger actions elsewhere in the module or app using <code><a href="https://rdrr.io/pkg/gargoyle/man/Event.html" class="external-link">gargoyle::watch()</a></code>. This should not need editing.</li>
<li>In the <em>result</em> block, use the relevant <code>input</code> values or <code>common</code> objects to produce <code>render*</code> objects which will be passed to the <code>_module_result</code> function.</li>
<li>In the <em>return</em> block, the current <code>input</code> values can be stored as a <code>list</code> inside the <code>save</code> function e.g. <code>select_date = input$date</code> when the app is saved and then retrieved when the app is loaded using various <code>updateInput</code> functions inside the <code>load</code> function e.g. <code>updateSelectInput(session, "date", selected = state$select_date</code>). This can be done automatically by calling <code><a href="reference/save_and_load.html">save_and_load()</a></code> either for all the modules or a single module.</li>
</ul>
<p>The <code>&lt;identifier&gt;_module_result</code> function contains the <code>*Output()</code> functions which would normally be included in the UI function. As in the <code>*_module_ui</code> function, the object ids need wrapping inside <code>ns()</code>.</p>
<p>The <code>&lt;identifier&gt;_module_map</code> function updates the <a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a> map. <code>map</code> is a <code><a href="https://rstudio.github.io/leaflet/reference/leafletProxy.html" class="external-link">leafletProxy()</a></code> object created in the main server function so leaflet functions can be piped to it e.g. <code>map &amp;&gt;&amp; addRasterImage()</code></p>
<p>The <code>*_module_rmd</code> function creates a list of objects which are passed to the module’s .Rmd file to reproduce the analysis. The first <code>*_knit</code> object is a boolean used to control whether or not the module has been used and therefore whether the markdown should be included in the user’s markdown. Writing this code can be semi-automated using the <code><a href="reference/metadata.html">metadata()</a></code> function once you have finished developing the module.</p>
</div>
<div class="section level5">
<h5 id="rmd">.Rmd<a class="anchor" aria-label="anchor" href="#rmd"></a>
</h5>
<p>This is a template for the rmarkdown that can be used to reproduce the module. Objects from <code>*_module_rmd</code> are passed into this template when the user downloads the rmarkdown. Objects from the <code>*_module_rmd</code> function are passed into the template when the document is knitted. If <code>module_setting</code> is added to the list in <code>*_module_rmd</code> then the value will be substituted for <code>{{module_setting}}</code> inside the .Rmd. If <code>module_setting</code> is a character string, then you need to use <code>"{{module_setting}}"</code> inside the .Rmd.</p>
</div>
<div class="section level5">
<h5 id="md">.md<a class="anchor" aria-label="anchor" href="#md"></a>
</h5>
<p>This is a guidance document to explain the theoretical background behind the module and how it has been implemented.</p>
</div>
<div class="section level5">
<h5 id="yml">.yml<a class="anchor" aria-label="anchor" href="#yml"></a>
</h5>
<p>This is a configuration file used when the modules are loaded. Add any R packages used inside the module or the function that it calls to <code>package</code> so that they can be cited. Package names should be included as plain text rather than as strings e.g. <code>package: [dplyr,shiny]</code>. The <code>short_name</code> field is used to generate the UI for selecting which module to use. By default it uses the <code>module</code> column of the <code>modules</code> dataframe but you may wish to edit this for clarity.</p>
</div>
<div class="section level5">
<h5 id="r-function">.R function<a class="anchor" aria-label="anchor" href="#r-function"></a>
</h5>
<p>This function performs the computation of the module. Creating this function separately to the shiny functionality is advantageous because it is easier to test, separates reactivity from computation, is easier to document, and because it can be called from inside the .Rmd file. Messages can be posted to the log from inside these functions if it is passed <code>common$logger</code> but this should set to <code>NULL</code> by default so that message are printed to the console when the function is used outside of the application. See <code>/R/select_query_f.R</code> for an example.</p>
</div>
</div>
<div class="section level4">
<h4 id="components">Components<a class="anchor" aria-label="anchor" href="#components"></a>
</h4>
<p>Each component has a skeleton guidance document located in <code>inst/shiny/Rmd</code> e.g. <code>gtext_plot.Rmd</code> which you should use to describe the functionality of the component in general and also include any relevant references.</p>
</div>
<div class="section level4">
<h4 id="serverr-and-uir">server.R and ui.R<a class="anchor" aria-label="anchor" href="#serverr-and-uir"></a>
</h4>
<p>These should not require substantial editing unless you wish to change the layout or appearance of the app. One exception is the block of code in <code>server.R</code> that creates the table because this is shared between modules.</p>
</div>
<div class="section level4">
<h4 id="theme">Theme<a class="anchor" aria-label="anchor" href="#theme"></a>
</h4>
<p>The colour of elements in the app are controlled by the theme present in the <code><a href="https://rdrr.io/pkg/bslib/man/bs_theme.html" class="external-link">bslib::bs_theme()</a></code> function inside <code>ui.R</code>. The default theme used is <code>spacelab</code>, but you can choose your own from <a href="https://bootswatch.com/" class="external-link uri">https://bootswatch.com/</a>.</p>
</div>
<div class="section level4">
<h4 id="commonr">common.R<a class="anchor" aria-label="anchor" href="#commonr"></a>
</h4>
<p>This file contains the data structure that is shared between modules and you can add extra objects as you wish. <code>common</code> is an <a href="https://r6.r-lib.org/" class="external-link">R6 class</a> which is similar to a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> but items in it must be declared in this file before you use them in the app. Any type of object can be stored in <code>common</code>, i.e. dataframes, plots, strings etc. By default, all the objects in <code>common</code> are created as <code>NULL</code> but you may wish to change these to load a default value. Objects inside <code>common</code> are not reactive by default, but you can make them <code>reactiveVal</code> or <code>reactiveValues</code>, for example like <code>common$logger</code>. Objects in <code>common</code> can also be functions, for example in the demonstration app, <code>common$add_map_layer()</code> is used to add a layer to <code>common$map_layers</code>.</p>
</div>
<div class="section level4">
<h4 id="rrun_moduler">R/run_module.R<a class="anchor" aria-label="anchor" href="#rrun_moduler"></a>
</h4>
<p>This function is designed to make it easier to develop modules by being able to run a single module in isolation. If your module requires objects from previous steps in an analysis, you can modify this function to modify the state of <code>common</code> so that the objects a module is dependent on are available immediately. For example, in the demonstration app, the function loads a raster image from a file when the module being run is from the plot component.</p>
</div>
<div class="section level4">
<h4 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a>
</h4>
<p>One test file for each module is created by <code><a href="reference/create_template.html">create_template()</a></code> and placed in <code>tests/testthat/</code>. It contains one unit test for the function which checks that it returns <code>NULL</code> and one end-to-end test which runs the app runs and that one of the objects in <code>common</code> remains set as <code>NULL</code>. During development of the modules, you should add tests to check the function runs as expected, returns errors when it cannot run and that the function runs when called from the app.</p>
<div class="section level5">
<h5 id="unit-tests">Unit tests<a class="anchor" aria-label="anchor" href="#unit-tests"></a>
</h5>
<p>Unit tests should be added for each function called by each module to ensure that it produces the intended output and returns errors appropriately. These tests are run in the conventional manner by <a href="https://testthat.r-lib.org" class="external-link">testthat</a>.</p>
</div>
<div class="section level5">
<h5 id="end-to-end-testing">End-to-end testing<a class="anchor" aria-label="anchor" href="#end-to-end-testing"></a>
</h5>
<p>End-to-end testing is used to validate that the app itself functions and uses <a href="https://rstudio.github.io/shinytest2/" class="external-link">shinytest2</a>. Tests can be recorded using <code><a href="https://rstudio.github.io/shinytest2/reference/record_test.html" class="external-link">shinytest2::record_test()</a></code> but the snapshot functionality of the package does not work well with the architecture of this package. Recording tests is still a useful way to record the input names required to navigate through the app though. <code>common</code> is made available for use inside tests by using <code>common &lt;- app$get_value(export = "common")</code> so you can check that objects are in the expected state after running a module. This method is quite flaky however and if it does not work, alternatively <code>common</code> can be accessed by using the save functionality:</p>
<pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">set_inputs</span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Save"</span><span class="op">)</span></span>
<span><span class="va">save_file</span> <span class="op">&lt;-</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_download</span><span class="op">(</span><span class="st">"core_save-save_session"</span>, filename <span class="op">=</span> <span class="va">save_path</span><span class="op">)</span></span>
<span><span class="va">common</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">save_file</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="adding-extra-modules">Adding extra modules<a class="anchor" aria-label="anchor" href="#adding-extra-modules"></a>
</h4>
<p>Further modules can be added using <code><a href="reference/create_module.html">create_module()</a></code> which creates the four files for the module. The module configuration file then needs to be added to <code>base_module_configs</code> in <code>global.R</code> and should be placed in the relevant position for the analysis since this vector controls the order of chunks within the Rmarkdown output. Any extra data objects that the modules creates must be added to <code>common.R</code>. This does not currently create the testing files or function file so these must be added manually.</p>
</div>
<div class="section level4">
<h4 id="asynchronous-modules">Asynchronous modules<a class="anchor" aria-label="anchor" href="#asynchronous-modules"></a>
</h4>
<p>Support for asynchronous operations was added in v0.2.0 using the new <code>ExtendedTask</code> feature added in <a href="https://shiny.posit.co/" class="external-link">shiny</a> v1.8.1. This has the advantage of allowing long-running operations to run in the background whilst the app remains responsive to the user and any other users connected to the same instance. Running modules asynchronously increases complexity however and requires several changes to structure of modules and the app itself. The <code>select_async</code> module contains an implementation that is functionally identical to <code>select_query</code> but runs asynchronously.</p>
<div class="section level5">
<h5 id="running-tasks">Running tasks<a class="anchor" aria-label="anchor" href="#running-tasks"></a>
</h5>
<p><code>common$tasks</code> is a list that stores details of all the asynchronous tasks. Each task is added to the list above the <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent()</a></code> in the <code>&lt;identifier&gt;_module_server</code> function as <code>common$tasks$&lt;identifier&gt;</code>. The task contains the module’s function wrapped by <code><a href="https://rstudio.github.io/promises/reference/future_promise.html" class="external-link">promises::future_promise()</a></code> and bound to a <code><a href="https://rdrr.io/pkg/bslib/man/bind_task_button.html" class="external-link">bslib::bind_task_button()</a></code> which disables the button when the task is running:</p>
<pre><code>common$tasks$&lt;identifier&gt; &lt;- ExtendedTask$new(function(...) {
    promises::future_promise({
      &lt;identifer&gt;(...)
    })
  }) |&gt; bslib::bind_task_button("run")</code></pre>
<p>The task is invoked inside the <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent()</a></code> by calling <code>common$tasks$&lt;identifier&gt;$invoke()</code> with the arguments of the module’s function. As in the default implementation, metadata should be stored at this point when the function is called.</p>
</div>
<div class="section level5">
<h5 id="logging">Logging<a class="anchor" aria-label="anchor" href="#logging"></a>
</h5>
<p>Because the asynchronous tasks are run in a different R session, <code>common$logger</code> is no longer accessible from inside the module’s function and therefore cannot be used to send messages to the logger directly. Instead, an <code>async</code> parameter needs to be added to the function and error messages are returned by the function when <code>async</code> is <code>TRUE</code> or transferred to <code>stop</code> or <code>warning</code> if <code>async</code> is <code>FALSE</code> e.g. when being used in the .Rmd.</p>
</div>
<div class="section level5">
<h5 id="receiving-results">Receiving results<a class="anchor" aria-label="anchor" href="#receiving-results"></a>
</h5>
<p>A separate <code><a href="https://rdrr.io/pkg/shiny/man/observe.html" class="external-link">observe()</a></code> named <code>results</code> is required to listen for the result of the task available at <code>common$tasks$&lt;identifier&gt;$result()</code> but to prevent endless loops, we must stop the observer from functioning once the results are calculated by calling <code>results$suspend()</code> and reactivate it prior to the task being invoked using <code>results$resume()</code>. Inside <code>results</code>, the class of the object returned by the function should be checked and either passed to <code>common$logger</code> if it is an error message or stored in <code>common</code> as in the default implementation.</p>
</div>
<div class="section level5">
<h5 id="mapping">Mapping<a class="anchor" aria-label="anchor" href="#mapping"></a>
</h5>
<p>In the default implementation, only the mapping function of the currently selected module can be called, which prevents the result of an asynchronous task being added to the map. Instead <code>map</code> is passed as an argument to the module server function and then called once the result has been produced using <code>do.call("&lt;identifier&gt;_module_map", list(map, common))</code>.</p>
</div>
<div class="section level5">
<h5 id="end-to-end-testing-1">End-to-end testing<a class="anchor" aria-label="anchor" href="#end-to-end-testing-1"></a>
</h5>
<p>The task needs to started using <code>app$click(selector = "#&lt;identifier&gt;-run")</code>. <a href="https://rstudio.github.io/shinytest2/" class="external-link">shinytest2</a> cannot detect that an asynchronous task is running and so the <code>timeout</code> parameter of <code><a href="https://rstudio.github.io/shinytest2/reference/AppDriver.html" class="external-link">shinytest2::AppDriver()</a></code> must be set to allow sufficient time for the function to run. An <code>input</code> value should be set inside <code>results</code> using <code>shinyjs::runjs("Shiny.setInputValue('&lt;identifier&gt;-complete', 'complete');")</code> which can then be detected inside the test using <code>app$wait_for_value(input = "&lt;identifier&gt;-complete")</code> to indicate that the task has completed.</p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="acknowledgments">Acknowledgments<a class="anchor" aria-label="anchor" href="#acknowledgments"></a>
</h2>
<p>shinyscholar was developed as part of a project to develop digital tools for modelling infectious diseases <a href="https://wellcome.org/news/digital-tools-climate-sensitive-infectious-disease" class="external-link">funded by Wellcome</a> at the <a href="https://le.ac.uk/" class="external-link">University of Leicester</a>. The version of Wallace that shinyscholar was derived from was funded by the <a href="https://www.gbif.org/" class="external-link">Global Biodiversity Information Facility</a>, <a href="https://www.nsf.gov/" class="external-link">National Science Foundation</a> and <a href="https://www.nasa.gov/" class="external-link">NASA</a>.</p>
</div>
<div class="section level2">
<h2 id="notes-for-windows-users">Notes for Windows users<a class="anchor" aria-label="anchor" href="#notes-for-windows-users"></a>
</h2>
<div class="section level3">
<h3 id="pdf-download-of-session-code">PDF download of session code<a class="anchor" aria-label="anchor" href="#pdf-download-of-session-code"></a>
</h3>
<p>If PDF downloading of session code is not working for you, please follow the following instructions, taken from <a href="https://github.com/rstudio/shiny-examples/issues/34" target="_blank" class="external-link">here</a>: - Step 1: Download and Install MiKTeX from <a href="http://miktex.org/2.9/setup" class="external-link uri">http://miktex.org/2.9/setup</a> - Step 2: Run <code>Sys.getenv("PATH")</code> in R studio. This command returns the path where Rstudio is trying to find pdflatex.exe. In Windows (64-bit), it should return “C:Files.exe”. If pdflatex.exe is not located in this location Rstudio gives this error code 41. - Step 3: To set this path variable run: <code>Sys.setenv(PATH=paste(Sys.getenv("PATH"),"C:/Program Files/MiKTeX 2.9/miktex/bin/x64/",sep=";"))</code>.</p>
</div>
<div class="section level3">
<h3 id="only-for-github-installation">Only for Github installation<a class="anchor" aria-label="anchor" href="#only-for-github-installation"></a>
</h3>
<p>If you are using Windows, please download and install <a href="https://cran.r-project.org/bin/windows/Rtools/" target="_blank" class="external-link">RTools</a> before installing the <code>devtools</code> package. After you install RTools, please make sure you add “C:” to your PATH variable (instructions <a href="https://stackoverflow.com/questions/29129681/create-zip-file-error-running-command-had-status-127/29480538#29480538" target="_blank" class="external-link">here</a>). Additionally, when using <code>devtools</code> on Windows machines, there is a known <a href="https://github.com/r-lib/devtools/issues/1298" target="_blank" class="external-link">bug</a> that sometimes results in the inability to download all package dependencies. If this happens to you, please install the packages and their dependencies directly from CRAN.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing shinyscholar</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Simon E. H. Smart <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Simon E. H. Smart.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
